{% extends "base/base.html" %}


{% block body_attrs %}
  ng-app='projects_members'
{% endblock %}


{% block js %}
  <script src="{{ url_for('static', filename='deps/angular/angular-resource.min.js') }}"></script>
  <script src="{{ url_for('static', filename='focus2/js/projects_members.js') }}" type='text/javascript'></script>
{% endblock %}


{% block content %}
  {% from "base/macros.html" import search_pagination %}

  <div class='container'>
    <div ng-view>
    </div>
  </div>

  <script type="text/ng-template" id="partials/search.html">
    <div class="row spaceup">
      <div class="span12">
        <form class="form-inline form" method="GET" action="{{ request.url }}">
          <div class="input-append">
            <input type="text" class="span2 search" ng-model="query"/>
            <a class="btn" ng-click="update_location()">Search</a>
          </div>
          {% raw %}
            <span>Page size:</span>
            <select style="width: auto" ng-model="perPage" ng-change="update_location()">
              <option ng-repeat="x in per_page_choices">{{ x }}</option>
            </select>
          {% endraw %}

          <select ui-select2 multiple data-placeholder="Projects" ng-model="projects">
            {% for project in data["projects"] %}
              <option>{{ project["name"] }}</option>
            {% endfor %}
          </select>
        </form>
      </div>
    </div>

    <table class="table table-striped table-bordered table-condensed" style="margin-top: 5px;">
    <thead>
      <tr>
        <th>
          Name
        </th>
        <th>
          Full Name
        </th>
        <th>
          E-Mail
        </th>
        <th>
          Projects&nbsp;<span ui-jq="tooltip" title="only projects you are involved in"
          <i class="icon-question-sign"></i></span>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr ng-hide="search.data.length > 0">
        <td colspan="4">No data to show</td>
      </tr>
      {% raw %}
      <tr ng-repeat="obj in search.data">
        <td>
          {{ obj["name"] }}
        </td>
        <td>
          {{ obj["fullname"] || obj["name"] }}
        </td>
        <td>
          {{ obj["email"] }}
        </td>
        <td>
          <a ng-repeat='project in obj["projects"]'
             href='{% endraw %}{{ url_for("projects.show", id="") }}{% raw %}{{ project["id"] }}'>
            {{ project["name"] }}
          </a>
        </td>
      </tr>
      {% endraw %}
    </tbody>
  </table>

{{ search_pagination() }}

</script>
{% endblock %}
