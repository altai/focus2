{% extends "base/base.html" %}


{% block js %}
<script src="{{ url_for('static', filename='focus2/js/instances_spawn.js') }}"></script>
{% endblock %}


{% block content %}
{% from 'base/macros.html' import input_horizontal %}
{% from 'base/macros.html' import select_horizontal %}

  <script>
    window.data = {{ data|tojson|safe }}
  </script>

  <div class='container' ng-app='instances_spawn'>
  <div class='row' ng-controller='SpawnController'>
    <div class='span6'>
      <form action='.' class='form-horizontal well ng-pristine ng-valid'
            id='spawn_form' method='POST'>
        <fieldset>
          {{ select_horizontal(
                 form.project,
                 data=data, is_required=True,
                 data_placeholder='Select Project',
                 tabindex='1')
          }}
          {{ select_horizontal(
                 form.image,
                 data=data, is_required=True,
                 plus_button_href=url_for("images.register"),
                 data_placeholder='Select Image',
                 tabindex='2') }}
          {{ select_horizontal(
                 form.instance_type, data=data, is_required=True,
                 data_placeholder='Select Type',
                 tabindex='3') }}
          {{ input_horizontal(form.name, is_required=True) }}


          <div class="control-group"  ng-show="!show_advanced">
            <label class="control-label">
              <a ng-click="show_advanced=true">Show Advanced</a>
            </label>
          </div>
          <div class="control-group"  ng-show="show_advanced"  style="border-bottom: 1px solid #E5E5E5">
            <label class="control-label">
              <a ng-click="show_advanced=false">Show Basic</a>
            </label>
          </div>

          {{ select_horizontal(form.ssh_key,
                 data=data, is_required=False,
                 group_attrs='ng-show="show_advanced"',
                 plus_button_href='add_new_keypair.html',
                 data_placeholder='Select SSH Key Pair',
                 opt_id="name",
                 tabindex='4') }}
          {{ select_horizontal(form.fw_rule_set,
                 is_multiple=True,
                 data=data, is_required=False,
                 group_attrs='ng-show="show_advanced"',
                 plus_button_href='add_new_fw_rule_set.html',
                 tabindex='4') }}

          <div class="control-group" ng-show="show_advanced">
            <label class="control-label">Lifespan</label>
            <div class="controls">
              <p>
                <input
                   type="checkbox"
                   ng-model="infinite_lifespan"
                   style="margin-top: -4px;"/>
                <span style="display: inline-block; margin-top: 6px;">
                  Infinite
                </span>
              </p>
              <div ng-show="!infinite_lifespan">
                <div>
                  Maximum instance lifespan:
                  <span>
                    {{ human_readable_lifespan }}
                  </span>
                </div>
                <div class="slider" slider></div>
              </div>
            </div>
          </div>

           <div class="form-actions">
             <button class="btn btn-primary" type="submit" tabindex="9"> Spawn it</button>
             <a class="btn" tabindex="9" href="javascript: history.back();">Cancel</a>
           </div>
        </fieldset>
      </form>
    </div>

    <div class='span6'>
      {% raw %}
        <div ng-show="form.image">
          <h3>Image Details</h3>
          <table cellspacing="0" cellpadding="0" width="700">
            <tr><td width="25%">ID:</td><td>{{form.image}}</td></tr>
            <tr><td>Disk Format:</td><td>{{form.image | fieldbyid:"image":"disk-format" | diskformat}}</td></tr>
            <tr><td>Size:</td><td>{{form.image | fieldbyid:"image":"size" | filesizeformat}}</td></tr></table>
        </div>

        <div ng-show="form.instance_type">
          <h3 style="margin-top: 20px;">Type Details</h3>
          <table cellspacing="0" cellpadding="0" width="700">
            <tr><td width="25%">ID:</td><td>{{form.instance_type}}</td></tr>
            <tr><td>Virtual CPUs:</td><td>{{form.instance_type | fieldbyid:"instance_type":"cpus"}}</td></tr>
            <tr><td>RAM:</td><td>{{form.instance_type | fieldbyid:"instance_type":"ram" | filesizeformat}}</td></tr>
            <tr><td>Disk:</td><td>{{form.instance_type | fieldbyid:"instance_type":"root-size" | filesizeformat}}</td></tr>
            <tr><td>Additional Disk:</td><td>{{form.instance_type | fieldbyid:"instance_type":"ephemeral-size" | filesizeformat}}</td>
          </table>
        </div>

        <div ng-show="form.ssh_key">
          <h3 style="margin-top: 20px;">SSH Key Details</h3>
          <table cellspacing="0" cellpadding="0" width="700">
            <tr><td width="25%">Fingerprint:</td><td>{{form.ssh_key | fieldbyid:"ssh_key":"fingerprint":"name"}}</td></tr>
          </table>
        </div>
      {% endraw %}

      <h3 style="margin-top: 20px;">Security Groups Details</h3>
      <table width="700" class="table table-striped table-bordered table-condensed">
        <thead>
          <tr><th>IP Range</th><th>Ports</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>*</td><td>22</td>
          </tr><tr>
            <td>172.18.40.101&nbsp;-&nbsp;172.18.40.107</td><td>80, 81, 90, 8001-8005</td>
          </tr>
        </tbody>
      </table>
      <h3 style="margin-top: 20px;">Estimated Cost</h3>
      <table width="700" class="table">
        <thead>
          <tr>
            <th>Summary:</th>
            <th>$6.8/month</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td width="25%">Type</td>
            <td>$2/month</td>
          </tr>
          <tr>
            <td>Virtual CPUs</td>
            <td>$1.3/month</td>
          </tr>
          <tr>
            <td>RAM</td>
            <td>$3/month</td>
          </tr>
          <tr>
            <td>Disk</td>
            <td>$0.5/month</td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>
</div>
{% endblock %}
